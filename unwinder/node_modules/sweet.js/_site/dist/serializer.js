"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.serializer = exports.makeDeserializer = undefined;

var _transitJs = require("transit-js");

var _transitJs2 = _interopRequireDefault(_transitJs);

var _immutable = require("immutable");

var _syntax = require("./syntax");

var _syntax2 = _interopRequireDefault(_syntax);

var _symbol = require("./symbol");

var _tokenizer = require("shift-parser/dist/tokenizer");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var typeMap_466 = [_tokenizer.TokenType.STRING, _tokenizer.TokenType.EOS, _tokenizer.TokenType.LPAREN, _tokenizer.TokenType.RPAREN, _tokenizer.TokenType.LBRACK, _tokenizer.TokenType.RBRACK, _tokenizer.TokenType.LBRACE, _tokenizer.TokenType.RBRACE, _tokenizer.TokenType.COLON, _tokenizer.TokenType.SEMICOLON, _tokenizer.TokenType.PERIOD, _tokenizer.TokenType.ELLIPSIS, _tokenizer.TokenType.ARROW, _tokenizer.TokenType.CONDITIONAL, _tokenizer.TokenType.INC, _tokenizer.TokenType.DEC, _tokenizer.TokenType.ASSIGN, _tokenizer.TokenType.ASSIGN_BIT_OR, _tokenizer.TokenType.ASSIGN_BIT_XOR, _tokenizer.TokenType.ASSIGN_BIT_AND, _tokenizer.TokenType.ASSIGN_SHL, _tokenizer.TokenType.ASSIGN_SHR, _tokenizer.TokenType.ASSIGN_SHR_UNSIGNED, _tokenizer.TokenType.ASSIGN_ADD, _tokenizer.TokenType.ASSIGN_SUB, _tokenizer.TokenType.ASSIGN_MUL, _tokenizer.TokenType.ASSIGN_DIV, _tokenizer.TokenType.ASSIGN_MOD, _tokenizer.TokenType.COMMA, _tokenizer.TokenType.OR, _tokenizer.TokenType.AND, _tokenizer.TokenType.BIT_OR, _tokenizer.TokenType.BIT_XOR, _tokenizer.TokenType.BIT_AND, _tokenizer.TokenType.SHL, _tokenizer.TokenType.SHR, _tokenizer.TokenType.SHR_UNSIGNED, _tokenizer.TokenType.ADD, _tokenizer.TokenType.SUB, _tokenizer.TokenType.MUL, _tokenizer.TokenType.DIV, _tokenizer.TokenType.MOD, _tokenizer.TokenType.EQ, _tokenizer.TokenType.NE, _tokenizer.TokenType.EQ_STRICT, _tokenizer.TokenType.NE_STRICT, _tokenizer.TokenType.LT, _tokenizer.TokenType.GT, _tokenizer.TokenType.LTE, _tokenizer.TokenType.GTE, _tokenizer.TokenType.INSTANCEOF, _tokenizer.TokenType.IN, _tokenizer.TokenType.NOT, _tokenizer.TokenType.BIT_NOT, _tokenizer.TokenType.AWAIT, _tokenizer.TokenType.DELETE, _tokenizer.TokenType.TYPEOF, _tokenizer.TokenType.VOID, _tokenizer.TokenType.BREAK, _tokenizer.TokenType.CASE, _tokenizer.TokenType.CATCH, _tokenizer.TokenType.CLASS, _tokenizer.TokenType.CONTINUE, _tokenizer.TokenType.DEBUGGER, _tokenizer.TokenType.DEFAULT, _tokenizer.TokenType.DO, _tokenizer.TokenType.ELSE, _tokenizer.TokenType.EXPORT, _tokenizer.TokenType.EXTENDS, _tokenizer.TokenType.FINALLY, _tokenizer.TokenType.FOR, _tokenizer.TokenType.FUNCTION, _tokenizer.TokenType.IF, _tokenizer.TokenType.IMPORT, _tokenizer.TokenType.LET, _tokenizer.TokenType.NEW, _tokenizer.TokenType.RETURN, _tokenizer.TokenType.SUPER, _tokenizer.TokenType.SWITCH, _tokenizer.TokenType.THIS, _tokenizer.TokenType.THROW, _tokenizer.TokenType.TRY, _tokenizer.TokenType.VAR, _tokenizer.TokenType.WHILE, _tokenizer.TokenType.WITH, _tokenizer.TokenType.NULL, _tokenizer.TokenType.TRUE, _tokenizer.TokenType.FALSE, _tokenizer.TokenType.YIELD, _tokenizer.TokenType.NUMBER, _tokenizer.TokenType.STRING, _tokenizer.TokenType.REGEXP, _tokenizer.TokenType.IDENTIFIER, _tokenizer.TokenType.CONST, _tokenizer.TokenType.TEMPLATE, _tokenizer.TokenType.ILLEGAL];
var ListHandler_467 = _transitJs2.default.makeWriteHandler({ tag: function tag() {
    return "array";
  }, rep: function rep(v_472) {
    return v_472;
  } });
var SyntaxHandler_468 = _transitJs2.default.makeWriteHandler({ tag: function tag() {
    return "stx";
  }, rep: function rep(v_473) {
    if (_immutable.List.isList(v_473.token)) {
      return [v_473.token, v_473.context.scopeset];
    } else {
      var t = _transitJs2.default.objectToMap(v_473.token);
      t.set("type", typeMap_466.indexOf(v_473.token.type));
      return [t, v_473.context.scopeset];
    }
  } });
var SymbolHandler_469 = _transitJs2.default.makeWriteHandler({ tag: function tag() {
    return "symb";
  }, rep: function rep(v_474) {
    return [v_474.name];
  } });
var writer_470 = _transitJs2.default.writer("json", { handlers: _transitJs2.default.map([_immutable.List, ListHandler_467, _syntax2.default, SyntaxHandler_468, _symbol.SymbolClass, SymbolHandler_469]) });
function makeReader_471(bindings_475) {
  return _transitJs2.default.reader("json", { arrayBuilder: { init: function init(node_476) {
        return (0, _immutable.List)().asMutable();
      }, add: function add(ret_477, val_478, node_479) {
        return ret_477.push(val_478);
      }, finalize: function finalize(ret_480, node_481) {
        return ret_480.asImmutable();
      }, fromArray: function fromArray(arr_482, node_483) {
        return (0, _immutable.List)(arr_482);
      } }, handlers: { stx: function stx(rep_484) {
        if (_immutable.List.isList(rep_484[0])) {
          var token = rep_484[0];
          return new _syntax2.default(token, { bindings: bindings_475, scopeset: rep_484[1] });
        } else {
          var _token = _transitJs2.default.mapToObject(rep_484[0]);
          _token.type = typeMap_466[rep_484[0].get("type")];
          _token.slice = rep_484[0].has("slice") ? _transitJs2.default.mapToObject(rep_484[0].get("slice")) : undefined;
          return new _syntax2.default(_token, { bindings: bindings_475, scopeset: rep_484[1] });
        }
      }, symb: function symb(rep_485) {
        return (0, _symbol.Symbol)(rep_485[0]);
      } } });
}
exports.makeDeserializer = makeReader_471;
exports.serializer = writer_470;
//# sourceMappingURL=data:application/json;base64,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dkIsRUFBOEMsV0FBVyxtQkFBQyxPQUFELEVBQVUsUUFBVjtlQUF1QixxQkFBSyxPQUFMO09BQXZCLEVBQXBMLEVBQTJOLFVBQVUsRUFBQyxLQUFLLHNCQUFXO0FBQ25SLFlBQUksZ0JBQUssTUFBTCxDQUFZLFFBQVEsQ0FBUixDQUFaLENBQUosRUFBNkI7QUFDM0IsY0FBSSxRQUFRLFFBQVEsQ0FBUixDQUFSLENBRHVCO0FBRTNCLGlCQUFPLHFCQUFXLEtBQVgsRUFBa0IsRUFBQyxVQUFVLFlBQVYsRUFBd0IsVUFBVSxRQUFRLENBQVIsQ0FBVixFQUEzQyxDQUFQLENBRjJCO1NBQTdCLE1BR087QUFDTCxjQUFJLFNBQVEsb0JBQVEsV0FBUixDQUFvQixRQUFRLENBQVIsQ0FBcEIsQ0FBUixDQURDO0FBRUwsaUJBQU0sSUFBTixHQUFhLFlBQVksUUFBUSxDQUFSLEVBQVcsR0FBWCxDQUFlLE1BQWYsQ0FBWixDQUFiLENBRks7QUFHTCxpQkFBTSxLQUFOLEdBQWMsUUFBUSxDQUFSLEVBQVcsR0FBWCxDQUFlLE9BQWYsSUFBMEIsb0JBQVEsV0FBUixDQUFvQixRQUFRLENBQVIsRUFBVyxHQUFYLENBQWUsT0FBZixDQUFwQixDQUExQixHQUF5RSxTQUF6RSxDQUhUO0FBSUwsaUJBQU8scUJBQVcsTUFBWCxFQUFrQixFQUFDLFVBQVUsWUFBVixFQUF3QixVQUFVLFFBQVEsQ0FBUixDQUFWLEVBQTNDLENBQVAsQ0FKSztTQUhQO09BRHdRLEVBVXZRLE1BQU0sdUJBQVc7QUFDbEIsZUFBTyxvQkFBTyxRQUFRLENBQVIsQ0FBUCxDQUFQLENBRGtCO09BQVgsRUFWaVAsRUFBblAsQ0FBUCxDQURvQztDQUF0QztRQWUwQixtQkFBbEI7UUFBa0QsYUFBZCIsImZpbGUiOiJzZXJpYWxpemVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHRyYW5zaXQgZnJvbSBcInRyYW5zaXQtanNcIjtcbmltcG9ydCB7TGlzdH0gZnJvbSBcImltbXV0YWJsZVwiO1xuaW1wb3J0IFN5bnRheCBmcm9tIFwiLi9zeW50YXhcIjtcbmltcG9ydCB7U3ltYm9sLCBnZW5zeW0sIFN5bWJvbENsYXNzfSBmcm9tIFwiLi9zeW1ib2xcIjtcbmltcG9ydCB7VG9rZW5DbGFzcywgVG9rZW5UeXBlfSBmcm9tIFwic2hpZnQtcGFyc2VyL2Rpc3QvdG9rZW5pemVyXCI7XG5sZXQgdHlwZU1hcF80NjYgPSBbVG9rZW5UeXBlLlNUUklORywgVG9rZW5UeXBlLkVPUywgVG9rZW5UeXBlLkxQQVJFTiwgVG9rZW5UeXBlLlJQQVJFTiwgVG9rZW5UeXBlLkxCUkFDSywgVG9rZW5UeXBlLlJCUkFDSywgVG9rZW5UeXBlLkxCUkFDRSwgVG9rZW5UeXBlLlJCUkFDRSwgVG9rZW5UeXBlLkNPTE9OLCBUb2tlblR5cGUuU0VNSUNPTE9OLCBUb2tlblR5cGUuUEVSSU9ELCBUb2tlblR5cGUuRUxMSVBTSVMsIFRva2VuVHlwZS5BUlJPVywgVG9rZW5UeXBlLkNPTkRJVElPTkFMLCBUb2tlblR5cGUuSU5DLCBUb2tlblR5cGUuREVDLCBUb2tlblR5cGUuQVNTSUdOLCBUb2tlblR5cGUuQVNTSUdOX0JJVF9PUiwgVG9rZW5UeXBlLkFTU0lHTl9CSVRfWE9SLCBUb2tlblR5cGUuQVNTSUdOX0JJVF9BTkQsIFRva2VuVHlwZS5BU1NJR05fU0hMLCBUb2tlblR5cGUuQVNTSUdOX1NIUiwgVG9rZW5UeXBlLkFTU0lHTl9TSFJfVU5TSUdORUQsIFRva2VuVHlwZS5BU1NJR05fQURELCBUb2tlblR5cGUuQVNTSUdOX1NVQiwgVG9rZW5UeXBlLkFTU0lHTl9NVUwsIFRva2VuVHlwZS5BU1NJR05fRElWLCBUb2tlblR5cGUuQVNTSUdOX01PRCwgVG9rZW5UeXBlLkNPTU1BLCBUb2tlblR5cGUuT1IsIFRva2VuVHlwZS5BTkQsIFRva2VuVHlwZS5CSVRfT1IsIFRva2VuVHlwZS5CSVRfWE9SLCBUb2tlblR5cGUuQklUX0FORCwgVG9rZW5UeXBlLlNITCwgVG9rZW5UeXBlLlNIUiwgVG9rZW5UeXBlLlNIUl9VTlNJR05FRCwgVG9rZW5UeXBlLkFERCwgVG9rZW5UeXBlLlNVQiwgVG9rZW5UeXBlLk1VTCwgVG9rZW5UeXBlLkRJViwgVG9rZW5UeXBlLk1PRCwgVG9rZW5UeXBlLkVRLCBUb2tlblR5cGUuTkUsIFRva2VuVHlwZS5FUV9TVFJJQ1QsIFRva2VuVHlwZS5ORV9TVFJJQ1QsIFRva2VuVHlwZS5MVCwgVG9rZW5UeXBlLkdULCBUb2tlblR5cGUuTFRFLCBUb2tlblR5cGUuR1RFLCBUb2tlblR5cGUuSU5TVEFOQ0VPRiwgVG9rZW5UeXBlLklOLCBUb2tlblR5cGUuTk9ULCBUb2tlblR5cGUuQklUX05PVCwgVG9rZW5UeXBlLkFXQUlULCBUb2tlblR5cGUuREVMRVRFLCBUb2tlblR5cGUuVFlQRU9GLCBUb2tlblR5cGUuVk9JRCwgVG9rZW5UeXBlLkJSRUFLLCBUb2tlblR5cGUuQ0FTRSwgVG9rZW5UeXBlLkNBVENILCBUb2tlblR5cGUuQ0xBU1MsIFRva2VuVHlwZS5DT05USU5VRSwgVG9rZW5UeXBlLkRFQlVHR0VSLCBUb2tlblR5cGUuREVGQVVMVCwgVG9rZW5UeXBlLkRPLCBUb2tlblR5cGUuRUxTRSwgVG9rZW5UeXBlLkVYUE9SVCwgVG9rZW5UeXBlLkVYVEVORFMsIFRva2VuVHlwZS5GSU5BTExZLCBUb2tlblR5cGUuRk9SLCBUb2tlblR5cGUuRlVOQ1RJT04sIFRva2VuVHlwZS5JRiwgVG9rZW5UeXBlLklNUE9SVCwgVG9rZW5UeXBlLkxFVCwgVG9rZW5UeXBlLk5FVywgVG9rZW5UeXBlLlJFVFVSTiwgVG9rZW5UeXBlLlNVUEVSLCBUb2tlblR5cGUuU1dJVENILCBUb2tlblR5cGUuVEhJUywgVG9rZW5UeXBlLlRIUk9XLCBUb2tlblR5cGUuVFJZLCBUb2tlblR5cGUuVkFSLCBUb2tlblR5cGUuV0hJTEUsIFRva2VuVHlwZS5XSVRILCBUb2tlblR5cGUuTlVMTCwgVG9rZW5UeXBlLlRSVUUsIFRva2VuVHlwZS5GQUxTRSwgVG9rZW5UeXBlLllJRUxELCBUb2tlblR5cGUuTlVNQkVSLCBUb2tlblR5cGUuU1RSSU5HLCBUb2tlblR5cGUuUkVHRVhQLCBUb2tlblR5cGUuSURFTlRJRklFUiwgVG9rZW5UeXBlLkNPTlNULCBUb2tlblR5cGUuVEVNUExBVEUsIFRva2VuVHlwZS5JTExFR0FMXTtcbmxldCBMaXN0SGFuZGxlcl80NjcgPSB0cmFuc2l0Lm1ha2VXcml0ZUhhbmRsZXIoe3RhZzogKCkgPT4gXCJhcnJheVwiLCByZXA6IHZfNDcyID0+IHZfNDcyfSk7XG5sZXQgU3ludGF4SGFuZGxlcl80NjggPSB0cmFuc2l0Lm1ha2VXcml0ZUhhbmRsZXIoe3RhZzogKCkgPT4gXCJzdHhcIiwgcmVwOiB2XzQ3MyA9PiB7XG4gIGlmIChMaXN0LmlzTGlzdCh2XzQ3My50b2tlbikpIHtcbiAgICByZXR1cm4gW3ZfNDczLnRva2VuLCB2XzQ3My5jb250ZXh0LnNjb3Blc2V0XTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgdCA9IHRyYW5zaXQub2JqZWN0VG9NYXAodl80NzMudG9rZW4pO1xuICAgIHQuc2V0KFwidHlwZVwiLCB0eXBlTWFwXzQ2Ni5pbmRleE9mKHZfNDczLnRva2VuLnR5cGUpKTtcbiAgICByZXR1cm4gW3QsIHZfNDczLmNvbnRleHQuc2NvcGVzZXRdO1xuICB9XG59fSk7XG5sZXQgU3ltYm9sSGFuZGxlcl80NjkgPSB0cmFuc2l0Lm1ha2VXcml0ZUhhbmRsZXIoe3RhZzogKCkgPT4gXCJzeW1iXCIsIHJlcDogdl80NzQgPT4gW3ZfNDc0Lm5hbWVdfSk7XG5sZXQgd3JpdGVyXzQ3MCA9IHRyYW5zaXQud3JpdGVyKFwianNvblwiLCB7aGFuZGxlcnM6IHRyYW5zaXQubWFwKFtMaXN0LCBMaXN0SGFuZGxlcl80NjcsIFN5bnRheCwgU3ludGF4SGFuZGxlcl80NjgsIFN5bWJvbENsYXNzLCBTeW1ib2xIYW5kbGVyXzQ2OV0pfSk7XG5mdW5jdGlvbiBtYWtlUmVhZGVyXzQ3MShiaW5kaW5nc180NzUpIHtcbiAgcmV0dXJuIHRyYW5zaXQucmVhZGVyKFwianNvblwiLCB7YXJyYXlCdWlsZGVyOiB7aW5pdDogbm9kZV80NzYgPT4gTGlzdCgpLmFzTXV0YWJsZSgpLCBhZGQ6IChyZXRfNDc3LCB2YWxfNDc4LCBub2RlXzQ3OSkgPT4gcmV0XzQ3Ny5wdXNoKHZhbF80NzgpLCBmaW5hbGl6ZTogKHJldF80ODAsIG5vZGVfNDgxKSA9PiByZXRfNDgwLmFzSW1tdXRhYmxlKCksIGZyb21BcnJheTogKGFycl80ODIsIG5vZGVfNDgzKSA9PiBMaXN0KGFycl80ODIpfSwgaGFuZGxlcnM6IHtzdHg6IHJlcF80ODQgPT4ge1xuICAgIGlmIChMaXN0LmlzTGlzdChyZXBfNDg0WzBdKSkge1xuICAgICAgbGV0IHRva2VuID0gcmVwXzQ4NFswXTtcbiAgICAgIHJldHVybiBuZXcgU3ludGF4KHRva2VuLCB7YmluZGluZ3M6IGJpbmRpbmdzXzQ3NSwgc2NvcGVzZXQ6IHJlcF80ODRbMV19KTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHRva2VuID0gdHJhbnNpdC5tYXBUb09iamVjdChyZXBfNDg0WzBdKTtcbiAgICAgIHRva2VuLnR5cGUgPSB0eXBlTWFwXzQ2NltyZXBfNDg0WzBdLmdldChcInR5cGVcIildO1xuICAgICAgdG9rZW4uc2xpY2UgPSByZXBfNDg0WzBdLmhhcyhcInNsaWNlXCIpID8gdHJhbnNpdC5tYXBUb09iamVjdChyZXBfNDg0WzBdLmdldChcInNsaWNlXCIpKSA6IHVuZGVmaW5lZDtcbiAgICAgIHJldHVybiBuZXcgU3ludGF4KHRva2VuLCB7YmluZGluZ3M6IGJpbmRpbmdzXzQ3NSwgc2NvcGVzZXQ6IHJlcF80ODRbMV19KTtcbiAgICB9XG4gIH0sIHN5bWI6IHJlcF80ODUgPT4ge1xuICAgIHJldHVybiBTeW1ib2wocmVwXzQ4NVswXSk7XG4gIH19fSk7XG59XG5leHBvcnQge21ha2VSZWFkZXJfNDcxIGFzIG1ha2VEZXNlcmlhbGl6ZXIsIHdyaXRlcl80NzAgYXMgc2VyaWFsaXplcn07XG4iXX0=